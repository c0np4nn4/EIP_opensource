# # EIP-3529: Reduction in refunds


## 요약
`SELFDESTRUCT` 에서 *가스 환불* 을 제거하고 `SSTORE` 에서는 *가스 환불* 정도를 낮춤으로써, “exploit” 가 가능한 현재의 환불 정책을 수정합니다.

## EIP 제안 동기
`SELFDESTRUCT` 와 `SSTORE` 에 *가스 환불* 이 제안된 최초의 동기는 어플리케이션 개발자들이 “깔끔한 상태”의 어플리케이션을 작성하도록 동기를 부여하기 위해서였습니다. 여기서 “깔끔한 상태”란 더 이상 필요없는 저장소 슬롯과 컨트랙트를 비우는 것을 말합니다. 하지만, 이러한 기술은 기대보다 훨씬 낮은 결과를 보여주었고 심지어 *가스 환불* 은 아래와 같은 다양한 의도되지 않은 결과로 이어지기도 했습니다.
- *가스 환불* 은 **GasToken** 을 등장시킵니다.
  - GasToken은 낮은 수수료 기간에 가스를 구매하여 높은 수수료 기간에 사용함으로써 전체적인 트랜잭션 비용을 절감하는 메커니즘을 제공합니다. 이는 마치 '가스 저장 배터리'처럼 작동하며, 사용자가 비용이 낮은 시기에 가스를 사서 비용이 높은 시기에 활용할 수 있게 합니다.
  - 그러나 이 과정에서 GasToken을 저장하기 위해 필요한 상태 데이터가 증가하게 되어 **상태 크기가 커지는 문제**가 발생합니다. 또한, GasToken의 생성과 소멸 과정에서 상당량의 가스가 소모되어 **네트워크의 전체적인 가스 사용 효율이 저하됩니다**. 이러한 문제들은 네트워크의 성능에 부정적인 영향을 미칩니다.
- *가스 환불* 은 블록 크기의 변동성을 증가시킵니다.
  - 이더리움 블록체인에서 각 트랜잭션은 특정 양의 가스를 소비하고, *가스 환불* 은 소비된 가스의 일부를 다시 환불해주는 기능을 합니다.환불은 최대 트랜잭션 소비 가스의 50%까지 가능하다는 제한이 있습니다.
  - *가스 환불* 이 다음 트랜잭션에 추가적인 가스 공간을 제공하기 때문에, 이론적으로 한 블록에서 실제로 소비될 수 있는 가스의 양은 on-paper gas limit (블록에 대해 정해진 가스 한도) 의 거의 두 배에 이를 수 있습니다. 결과적으로, 한 블록 내에서 트랜잭션이 소비할 수 있는 가스의 양이 기대치보다 훨씬 높을 수 있으며, 이는 블록 크기의 변동성을 크게 증가시킵니다.
  - 이러한 변동성은 치명적이진 않습니다. 하지만, EIP-1559 가 도입되면서 블록당 가스 한도가 시장 매커니즘에 따라 동적으로 조정되는데, 환불을 통해 사용 가능한 가스가 증가하면 이로 인해 2배에 가까운 사용량 증가가 길게 유지될 수 있습니다. 따라서, EIP-1559의 도입 목적인 *블록 가스 사용의 더 정확한 조절과 예측 가능성 향상* 에 반하는 결과를 초래할 수도 있습니다. 이러한 문제는 네트워크 효율성과 안정성을 저하시킬 수 있습니다.
따라서,  `SSTORE` 와 `SELFDESTRUCT` EVM opcode 를 수정하여 이러한 *가스 환불* 에 관한 문제들을 해결하고자 합니다.

## 선정 이유
*gas fee* 나 *refund* 등 네트워크 안정성을 위해 도입된 경제학적 개념들에 대해 매우 생소하여, 이번 기회를 계기로 한번 이해해보고자 했습니다.

## 본론
`London hard fork` 에 해당하는 $12,965,000$ 번째 블록 이후부터 아래의 변화들이 적용됩니다.
- `SELFDESTRUCT` 에 대한 *환불* 이 제거됩니다.
- [EIP-2200](https://eips.ethereum.org/EIPS/eip-2200) 에서 정의된 `SSTORE_CLEARS_SCHEDULE` *환불 값* 을 `SSTORE_RESET_GAS + ACCESS_LIST_STORAGE_KEY_COST` 로 변경합니다. 이는 $4,800$ 이며 [EIP-2929](https://eips.ethereum.org/EIPS/eip-2929) 에서의 `COLD_SLOAD_COST` $(=2,100)$ 와 [EIP-2930](https://eips.ethereum.org/EIPS/eip-2930) 에서의 `ACCESS_LIST_STORAGE_KEY_COST` $(=1,900)$를 아래와 같이 반영한 결과입니다.

$$
\begin{align}
\text{SSTORE_RESET_GAS} - \text{COLD_SLOAD_COST} + \text{ACCESS_LIST_STORAGE_KEY_COST} \newline
&= 5,000 - 2,100 + 1,900 \newline
&= 4,800
\end{align}
$$

## Conclusion

---
## Reference
https://eips.ethereum.org/EIPS/eip-352

https://ethereum.org/en/history/#london
